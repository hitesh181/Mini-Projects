<!DOCTYPE html>
<html>
<head>
<title>Javascript based tetris</title>
</head>
<body>
<canvas id=myCanvas width=600 height=400></canvas>
<script>
var canvas;
var content;
var ballX=50, ballY = 100;
var speedX = 9; speedY =6;
var paddle1Y = 150, paddle2Y = 100;
const paddle_height = 100;
var score1= 0, score2 =0;
const winner = 2;
var gameContinues = false;

function calMousePos(evt){
	var rect = canvas.getBoundingClientRect();
    var root = document.documentElement;
    var mouseX = evt.clientX - rect.left - root.scrollLeft;
    var mouseY = evt.clientY - rect.top - root.scrollTop;
    return{
    	x: mouseX,
        y: mouseY
        };
}

window.onload = function(){
	canvas = document.getElementById('myCanvas');
    context = canvas.getContext('2d');
   	var  interval = setInterval(function(){
    			drawEverything();
                moveBall();
                
                }, 1000/30)
    canvas.addEventListener("mousemove", function(evt){
    				var pos = calMousePos(evt);
                    paddle1Y = pos.y - paddle_height/2;
                    });
}
function computerMove(){
	var paddleCenter = paddle2Y+ paddle_height/2;
	if( paddleCenter < ballY)
    	paddle2Y += 8;
    else if( paddleCenter > ballY)
    	paddle2Y -= 8;
 }
function ballReset(){
	if(score1 == winner || score2 == winner){
        gameContinues = true;
        score1 = 0;
        score2 = 0;
        //clearInterval(interval);
        //canvas.removeEventListener("mousemove", calMousePos)
        }
	ballX = canvas.width/2;
    speedX = -speedX;
}
function moveBall(){
	if(gameContinues)
    return;
    
	computerMove();
	ballX += speedX;
    ballY += speedY;
    if(ballX <11){
    	 if(ballY > paddle1Y && ballY < paddle1Y+paddle_height){
    		speedX = -speedX;
             var deltaY = ballY -(paddle1Y + paddle_height)/2;
             speedY = deltaY * 0.05;
		}            
         else{
         	score2++;
         	ballReset();
            
            }
    }
    if(ballX > canvas.width-9){
    	if(ballY > paddle2Y && ballY < paddle2Y+paddle_height){
    		speedX = -speedX;
            var deltaY = ballY -(paddle2Y + paddle_height)/2;
             speedY = deltaY * 0.05;
             }
         else{
         	score1++;
         	ballReset();
            
    }
    }
    if(ballY < 13 || ballY > canvas.height-13)
    	speedY = -speedY;
    }
function drawEverything(){
	if(gameContinues){
        if(score1>score2){
        	context.fillStyle='white';
        	context.fillText("Player 1 Wins", canvas.width/2-70,150);
            }
        else{
        	context.fillStyle='white';
        	context.fillText("Player 2 Wins", canvas.width/2-70,150);
            }
    context.fillText("Click to Continue", canvas.width/2-70,250);
    canvas.addEventListener('click', function(){gameContinues=false;
    											});
    return;
    }
    drawShapes('black',0, 0, canvas.width, canvas.height);
    drawShapes('white',00, paddle1Y, 10, paddle_height);
    drawShapes('white',canvas.width-10,paddle2Y, 10, paddle_height);
    drawText();
    drawNet();

}
function drawNet(){
	for(let i =0; i<canvas.height; i+=40)
    	drawShapes('white', canvas.width/2, i, 2,20);
}
function drawShapes(color, x, y,w, h){
	context.fillStyle = color;
    context.fillRect(x,y, w, h);
    drawBall('red');
    }
function drawText(){    
    context.fillStyle = 'white';
    context.font = 'italic 15pt Calibri';
    context.fillText("Score", canvas.width/2,50);
    context.fillText("Player 1", 50,100);
    context.fillText(score1, 65,130);
    context.fillText("Player 2", canvas.width-150,100);
    context.fillText(score2, canvas.width-130,130);
}

function drawBall(color){
    context.beginPath();
    context.arc(ballX, ballY, 10, 0, 2 * Math.PI);
	context.fillStyle = color;
    context.fill();
    }
</script>
</body>
</html>
